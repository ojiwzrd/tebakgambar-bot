/*
Bahasa Indonesia:
Disclaimer: Dilarang keras menjual belikan source ini, dan jika ingin mengedit, mengubah atau mendistribusikan kode ini jangan pernah hapus kode sumber utama.
Source: https://github.com/ojiwzrd
Kontak: 083170801193
Email: ojiwzrd@gmail.com
Komunitas: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
Copyright Â© 2025 OJIWZRD. All Rights Reserved

English:
Disclaimer: It is strictly forbidden to sell this source code. If you want to edit, modify or distribute this code, never remove the original source code.
Source: https://github.com/ojiwzrd
Contact: 083170801193
Email: ojiwzrd@gmail.com
Community: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
Copyright Â© 2025 OJIWZRD. All Rights Reserved

EspaÃ±ol:
Aviso: EstÃ¡ estrictamente prohibido vender este cÃ³digo fuente. Si deseas editar, modificar o distribuir este cÃ³digo, nunca elimines el cÃ³digo fuente original.
Fuente: https://github.com/ojiwzrd
Contacto: 083170801193
Correo: ojiwzrd@gmail.com
Comunidad: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
Derechos de autor Â© 2025 OJIWZRD. Todos los derechos reservados

FranÃ§ais:
Avis de non-responsabilitÃ© : Il est strictement interdit de vendre ce code source. Si vous souhaitez modifier, Ã©diter ou distribuer ce code, ne supprimez jamais le code source original.
Source : https://github.com/ojiwzrd
Contact : 083170801193
Email : ojiwzrd@gmail.com
CommunautÃ© : https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
Droits dâ€™auteur Â© 2025 OJIWZRD. Tous droits rÃ©servÃ©s

Deutsch:
Haftungsausschluss: Der Verkauf dieses Quellcodes ist strengstens untersagt. Wenn Sie diesen Code bearbeiten, Ã¤ndern oder verbreiten mÃ¶chten, entfernen Sie niemals den Original-Quellcode.
Quelle: https://github.com/ojiwzrd
Kontakt: 083170801193
E-Mail: ojiwzrd@gmail.com
Community: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
Copyright Â© 2025 OJIWZRD. Alle Rechte vorbehalten

æ—¥æœ¬èª:
å…è²¬äº‹é …ï¼šã“ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è²©å£²ã¯å³ç¦ã§ã™ã€‚ç·¨é›†ã€å¤‰æ›´ã€é…å¸ƒã‚’è¡Œã†å ´åˆã¯ã€å…ƒã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ãªã„ã§ãã ã•ã„ã€‚
ã‚½ãƒ¼ã‚¹ï¼šhttps://github.com/ojiwzrd
é€£çµ¡å…ˆï¼š083170801193
ãƒ¡ãƒ¼ãƒ«ï¼šojiwzrd@gmail.com
ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ï¼šhttps://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
è‘—ä½œæ¨© Â© 2025 OJIWZRDã€‚ç„¡æ–­è»¢è¼‰ã‚’ç¦ã˜ã¾ã™ã€‚

ä¸­æ–‡:
å…è´£å£°æ˜ï¼šä¸¥ç¦å‡ºå”®æ­¤æºä»£ç ã€‚å¦‚éœ€ç¼–è¾‘ã€ä¿®æ”¹æˆ–åˆ†å‘æ­¤ä»£ç ï¼Œè¯·å‹¿åˆ é™¤åŸå§‹æºä»£ç ã€‚
æ¥æºï¼šhttps://github.com/ojiwzrd
è”ç³»æ–¹å¼ï¼š083170801193
é‚®ç®±ï¼šojiwzrd@gmail.com
ç¤¾åŒºï¼šhttps://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
ç‰ˆæƒæ‰€æœ‰ Â© 2025 OJIWZRDã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

Ğ ÑƒÑÑĞºĞ¸Ğ¹:
ĞÑ‚ĞºĞ°Ğ· Ğ¾Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸: Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´. Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¸Ğ»Ğ¸ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ ĞºĞ¾Ğ´, Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞ¹Ñ‚Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´.
Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº: https://github.com/ojiwzrd
ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚: 083170801193
Ğ­Ğ». Ğ¿Ğ¾Ñ‡Ñ‚Ğ°: ojiwzrd@gmail.com
Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
ĞĞ²Ñ‚Ğ¾Ñ€ÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Â© 2025 OJIWZRD. Ğ’ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ñ‹.

í•œêµ­ì–´:
ë©´ì±… ì¡°í•­: ì´ ì†ŒìŠ¤ ì½”ë“œë¥¼ íŒë§¤í•˜ëŠ” ê²ƒì€ ì—„ê²©íˆ ê¸ˆì§€ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ í¸ì§‘, ìˆ˜ì • ë˜ëŠ” ë°°í¬í•˜ë ¤ë©´ ì›ë³¸ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì‚­ì œí•˜ì§€ ë§ˆì‹­ì‹œì˜¤.
ì¶œì²˜: https://github.com/ojiwzrd
ì—°ë½ì²˜: 083170801193
ì´ë©”ì¼: ojiwzrd@gmail.com
ì»¤ë®¤ë‹ˆí‹°: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
ì €ì‘ê¶Œ Â© 2025 OJIWZRD. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .

Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:
ØªÙ†ÙˆÙŠÙ‡: ÙŠÙÙ…Ù†Ø¹ Ù…Ù†Ø¹Ù‹Ø§ Ø¨Ø§ØªÙ‹Ø§ Ø¨ÙŠØ¹ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ. Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ØºØ¨ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ ØªÙˆØ²ÙŠØ¹ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŒ ÙÙ„Ø§ ØªØ­Ø°Ù Ø§Ù„Ø´ÙŠÙØ±Ø© Ø§Ù„Ù…ØµØ¯Ø±ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø£Ø¨Ø¯Ù‹Ø§.
Ø§Ù„Ù…ØµØ¯Ø±: https://github.com/ojiwzrd
Ø§Ù„Ø§ØªØµØ§Ù„: 083170801193
Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ojiwzrd@gmail.com
Ø§Ù„Ù…Ø¬ØªÙ…Ø¹: https://chat.whatsapp.com/Cr5mLtlRAdl0aRDYthz1Zj?mode=ac_t
Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 OJIWZRD. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
*/
import './config/settings.js'
import { Telegraf, session } from 'telegraf'
import fs from 'fs'
import path from 'path'
import db from './src/utils/lowdb.js'
import { Tebakgambar } from './src/handler/tebakgambar.js'
import Logger from './src/utils/logger.js'
import { setUserLang } from './src/utils/lang.js'

const bot = new Telegraf(global.bottoken)

bot.use(session()) // Use Session
bot.use(async (ctx, next) => {
  if (ctx.from) {
    await db.read()
    db.data.users ||= []
    if (!Array.isArray(db.data.users)) db.data.users = []
    const userId = ctx.from.id
    let user = db.data.users.find(u => u.id === userId)
    // save user data the first time they communicate
    if (!user) {
      let photo_url = ''
      try {
        const photos = await ctx.telegram.getUserProfilePhotos(userId, 0, 1)
        if (photos.total_count > 0) {
          const fileId = photos.photos[0][0].file_id
          const file = await ctx.telegram.getFile(fileId)
          photo_url = `https://api.telegram.org/file/bot${global.bottoken}/${file.file_path}`
        }
      } catch {}
      user = {
        id: userId,
        username: ctx.from.username || '',
        first_name: ctx.from.first_name || '',
        last_name: ctx.from.last_name || '',
        photo_url,
        lang: 'id',
        game_data: {}
      }
      db.data.users.push(user) 
      await db.write()
    } else if (!user.lang) {
      user.lang = 'id'
      await db.write()
    }
  }
  await setUserLang(ctx)
  if (ctx.message && ctx.from) {
    const username = ctx.from.username || ctx.from.first_name || 'Unknown'
    const text = ctx.message.text || '[non-text message]'
    Logger.info(`[Message] From: ${username} (${ctx.from.id}), Text: ${text}`)
  }
  await next()
})

// read the entire js command folder
async function loadCommands(dir) {
  const entries = fs.readdirSync(dir, { withFileTypes: true })
  for (const entry of entries) {
    const fullPath = path.join(dir, entry.name)
    if (entry.isDirectory()) {
      await loadCommands(fullPath)
    } else if (entry.isFile() && entry.name.endsWith('.js')) {
      const command = await import(fullPath)
      if (command.default && typeof command.default === 'function') command.default(bot)
    }
  }
}

await loadCommands(path.join(process.cwd(), 'cmd'))

bot.on('text', async (ctx) => {
  if (!ctx.message || !ctx.from) return
  try {
    await Tebakgambar(ctx)
  } catch (err) {
    Logger.error(`Message handler error: ${err.message}`)
  }
})

// Create default commands on Telegram bots
await bot.telegram.setMyCommands([
{ command: 'start', description: 'ğŸªµ Getting Started' },
{ command: 'language', description: 'ğŸ’­ Change Language' },
{ command: 'play', description: 'ğŸ›ï¸ Start Game' },
{ command: 'profile', description: 'ğŸ—’ï¸ Profile Information' }
])

bot.launch()
Logger.info('CONNECTED!!!')